<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="https://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      Using dependency injection correctly &middot; Thoughts
    
  </title>

  

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" /> -->
<!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic"> -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:900,300">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tonsky/FiraCode@1.207/distr/fira_code.css">


  <link href="//maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>

  <body class="post">

    <div id="sidebar">
  <header>
    <div class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        Thoughts
      </a>
    </div>
    <p class="lead">My thoughts on programming, motorcycles and life in general</p>
  </header>
  <nav id="sidebar-nav-links">
  
    <a class="home-link "
        href="/">Home</a>
  
  

  

  <a class="page-link "
          href="/about/">About</a>
    
  

  
    
      <a class="page-link "
          href="/archive/">Archive</a>
    
  

  

  

  
    
      <a class="page-link "
          href="/tags/">Tags</a>
  

  <!-- Optional additional links to insert in sidebar nav -->
</nav>

  

  <nav id="sidebar-icon-links">
  

  
  <a id="github-link"
     class="fa fa-github icon" title="Github" aria-label="Github"
     href="https://github.com/vignessh">
  </a>
  

  
  <a id="twitter-link"
     class="fa fa-twitter icon" title="Twitter" aria-label="Twitter"
     href="https://twitter.com/vignesshv">
  </a>
  

  
  <a id="instagram-link"
     class="fa fa-instagram icon" title="Instagram" aria-label="Instagram"
     href="https://instagram.com/vignesshv">
  </a>
  

  
  <a id="instagram-link"
     class="fa fa-linkedin icon" title="LinkedIn" aria-label="LinkedIn"
     href="https://www.linkedin.com/vignesshv">
  </a>
  

  
  <a id="instagram-link"
     class="fa fa-flickr icon" title="Flickr" aria-label="Flickr"
     href="https://www.flickr.com/vignessh">
  </a>
  

  <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>

  
  
  
  

  

  

  <!-- Optional additional links to insert for icons links -->
</nav>
  <p>
  &copy; 2020.

  Vignessh
  <!-- <a href="/LICENSE.md">MIT License.</a> -->
</p>
</div>

    <main class="container">
      <header>
  <h1 class="post-title">Using dependency injection correctly</h1>
</header>
<div class="content">
  <div class="post-meta">
  <span class="post-date">10 May 2013</span>
  <span class="post-categories">
    
  </span>
</div>

  <div class="post-body">
    <p>Even though dependency injection is a better understood concept now than in the past, there is still code being written that does not keep the principle in mind. The problem seems to be around recognizing which dependencies are needed when constructing the object and which ones need resolution at runtime.</p>

<!-- more -->
<p>To better explain the problem, here is a sample piece of code.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">BusinessProfileFinder</span>
<span class="p">{</span>
  <span class="k">private</span> <span class="k">readonly</span> <span class="n">IEnquiryService</span> <span class="n">enquiryService</span><span class="p">;</span>
  <span class="k">private</span> <span class="k">readonly</span> <span class="n">Parameter</span> <span class="n">parameter</span><span class="p">;</span>
  <span class="k">private</span> <span class="k">readonly</span> <span class="kt">string</span> <span class="n">businessReferenceCode</span><span class="p">;</span>

  <span class="k">public</span> <span class="nf">BusinessProfileFinder</span><span class="p">(</span><span class="n">IEnquiryService</span> <span class="n">enquiryService</span><span class="p">,</span> <span class="n">Parameter</span> <span class="n">parameter</span><span class="p">,</span> <span class="kt">string</span> <span class="n">businessReferenceCode</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="n">enquiryService</span> <span class="p">=</span> <span class="n">enquiryService</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="n">parameter</span> <span class="p">=</span> <span class="n">parameter</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="n">businessReferenceCode</span> <span class="p">=</span> <span class="n">businessReferenceCode</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="n">BusinessProfile</span> <span class="nf">Find</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="n">enquiryService</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="k">new</span> <span class="n">BusinessProfileRequest</span> <span class="p">{</span><span class="n">Parameter</span> <span class="p">=</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">ReferenceCode</span> <span class="p">=</span> <span class="n">businessReferenceCode</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>So this finder is just a wrapper over the actual service <code class="language-plaintext highlighter-rouge">EnquiryService</code> that is responsible for retrieving the <code class="language-plaintext highlighter-rouge">BusinessProfile</code> given certain parameters. At first glance, there is nothing really wrong with the way the above code has been written. But if you look closely, there are some issues. The constructor is taking arguments that are required for both construction as well as for the operation of this class.</p>

<p>Because of this, the caller of this class cannot express this as a dependency when configuring the DI container. Instead it will need to instantiate it at runtime by itself. Thereby we lose the ability to wire up dependencies, as well lose the ability to test it without resorting to hacks.</p>

<p>The same code could be re-written in a more test/dependency injection friendly way as below:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">BusinessProfileFinder</span>
<span class="p">{</span>
  <span class="k">private</span> <span class="k">readonly</span> <span class="n">IEnquiryService</span> <span class="n">enquiryService</span><span class="p">;</span>

  <span class="k">public</span> <span class="nf">BusinessProfileFinder</span><span class="p">(</span><span class="n">IEnquiryService</span> <span class="n">enquiryService</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="n">enquiryService</span> <span class="p">=</span> <span class="n">enquiryService</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="n">BusinessProfile</span> <span class="nf">Find</span><span class="p">(</span><span class="n">Parameter</span> <span class="n">parameter</span><span class="p">,</span> <span class="kt">string</span> <span class="n">businessReferenceCode</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="n">enquiryService</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="k">new</span> <span class="n">BusinessProfileRequest</span> <span class="p">{</span><span class="n">Parameter</span> <span class="p">=</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">ReferenceCode</span> <span class="p">=</span> <span class="n">businessReferenceCode</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Notice the change to the arguments to the constructor and the <code class="language-plaintext highlighter-rouge">Find</code> implementation. Looking at example, it becomes evident as to how writing test friendly code can also help with how dependencies are expressed and therefore help with design of the class under concern. It is important to understand the difference between dependencies that can be resolved during instantiation time vs. those that can only be resolved during run time.</p>

    <div class="post-tags">
  
    <span>
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">csharp</span>
    </span>
  
    <span>
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">tdd</span>
    </span>
  
</div>
  </div>

  <section class="comments">
    <h2>Comments</h2>
    <div id="disqus_thread">
    <button class="disqus-load" onClick="loadDisqusComments()">
      Load Comments
    </button>
  </div>
  <script>

  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW
  *  TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT:s
  *  https://disqus.com/admin/universalcode/#configuration-variables
  */
  var disqus_config = function () {
    this.page.url = "https://vignessh.github.io/blog/2013/05/10/using-dependency-injection-correctly/";
    this.page.identifier = "" ||
                           "https://vignessh.github.io/blog/2013/05/10/using-dependency-injection-correctly/";
  }
  function loadDisqusComments() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//vignessh.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  }
  </script>
  <noscript>
    Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript">comments powered by Disqus</a>.
  </noscript>
  </section>
  <section class="related">
  <h2>Related Posts</h2>
  <ul class="posts-list">
    
      <li>
        <h3>
          <a href="/blog/2013/04/28/using-castle-typefactory-facility/">
            Using Castle TypeFactory facility
            <small>28 Apr 2013</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2013/04/27/learning-functional-programming/">
            Learning functional programming - Part 1
            <small>27 Apr 2013</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2013/04/26/laziness-a-human-quality/">
            Laziness: A human quality
            <small>26 Apr 2013</small>
          </a>
        </h3>
      </li>
    
  </ul>
</section>
</div>

    </main>

    <!-- Optional footer content -->
  </body>
</html>
